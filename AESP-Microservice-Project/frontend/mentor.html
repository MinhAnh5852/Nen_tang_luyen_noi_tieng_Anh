<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mentor - AI English Speaking Platform</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!-- Header -->
  <header>
    <div class="container header-container">
      <a href="mentor.html" class="logo">
        <i class="fas fa-robot logo-icon"></i>
        <span class="logo-text">AI English Speaking</span>
      </a>

      <!-- Menu (link theo section của bạn) -->
      <nav class="nav-links">
        <a href="#" class="active" data-section="learners" onclick="showSection('learners'); return false;" id="menuLearnersTop">Học viên</a>
        <a href="#" data-section="progress" onclick="showSection('progress'); return false;" id="menuProgressTop">Tiến độ</a>
        <a href="#" data-section="feedback" onclick="showSection('feedback'); return false;" id="menuFeedbackTop">Phản hồi</a>
        <a href="#" data-section="tasks" onclick="showSection('tasks'); return false;" id="menuTasksTop">Giao bài</a>
        <a href="#" data-section="settings" onclick="showSection('settings'); return false;" id="menuSettingsTop">Cài đặt</a>
      </nav>

      <div class="user-menu">
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">MT</div>
          <span class="user-name" id="userName">Mentor Trần</span>
        </div>

        <!-- Dropdown: đổi ngôn ngữ + logout (giữ của bạn) -->
        <div style="position: relative; display:flex; gap:10px; align-items:center;">
          <button class="btn btn-outline btn-sm" id="profileBtn" onclick="toggleDropdown()">Mentor Profile ▼</button>
          <div id="dropdown" style="
              display:none; position:absolute; right:0; top:44px; background:#fff;
              min-width:180px; border:1px solid #e6eaf2; border-radius:12px;
              box-shadow: 0 10px 30px rgba(15,23,42,0.06); overflow:hidden; z-index:50;">
            <a href="#" style="display:block; padding:12px 14px; text-decoration:none; color:#111; font-weight:600;" onclick="switchLanguage('en'); return false;">EN</a>
            <a href="#" style="display:block; padding:12px 14px; text-decoration:none; color:#111; font-weight:600;" onclick="switchLanguage('vi'); return false;">VI</a>
            <a href="#" style="display:block; padding:12px 14px; text-decoration:none; color:#111; font-weight:600;" onclick="logout(); return false;" id="logoutText">Đăng xuất</a>
          </div>

          <a href="index.html" class="btn btn-outline">Đăng xuất</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="container">
    <div class="dashboard-header">
      <h1 id="title">Bảng Điều Khiển Mentor</h1>
      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <a href="#" class="btn btn-primary" onclick="showSection('tasks'); return false;">
          <i class="fas fa-calendar-plus"></i> <span id="assignNewTaskBtnTextTop">Giao bài mới</span>
        </a>
      </div>
    </div>

    <!-- Alerts (giữ của bạn) -->
    <div class="content-card" style="margin-bottom: 16px; background:#fff7db; border:1px solid #ffe6a3;">
      <strong id="alertsLabel">Cảnh báo:</strong>
      <span id="alertsText">3 học viên chưa luyện tập 7 ngày. 2 học viên cần phản hồi.</span>
    </div>

    <!-- Sections -->
    <section class="content-card section active" id="learnersSection">
      <h2 id="learnersTitle">Học Viên Của Tôi</h2>

      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom: 12px;">
        <input type="text" id="search" placeholder="Tìm theo tên hoặc email" onkeyup="filterLearners()"
               style="padding:10px 12px; border:1px solid #e6eaf2; border-radius:12px; min-width:240px;">
        <select id="filterStatus" onchange="filterLearners()"
                style="padding:10px 12px; border:1px solid #e6eaf2; border-radius:12px; min-width:220px;">
          <option value="" id="allStatusOption">Tất Cả Trạng Thái</option>
          <option value="active" id="activeOption">Hoạt Động</option>
          <option value="inactive" id="inactiveOption">Không Hoạt Động</option>
        </select>
      </div>

      <div class="table-container">
        <table class="data-table" id="learnersTable">
          <thead>
            <tr>
              <th id="idHeader">ID</th>
              <th id="nameHeader">Tên</th>
              <th id="levelHeader">Cấp Độ</th>
              <th id="lastPracticeHeader">Lần Luyện Gần Nhất</th>
              <th id="avgScoreHeader">Điểm TB</th>
              <th id="weakSkillHeader">Kỹ Năng Yếu</th>
              <th id="statusHeader">Trạng Thái</th>
              <th id="actionsHeader">Hành Động</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="noData" style="display:none; text-align:center; padding: 18px; color:#64748b;">
        Chưa có học viên nào được phân công.
      </div>
    </section>

    <section class="content-card section" id="progressSection" style="margin-top:16px;">
      <h2 id="progressTitle">Tiến Độ Học Viên</h2>

      <div style="margin-bottom: 12px;">
        <select id="learnerSelect" style="width:100%; max-width:520px; padding:10px 12px; border:1px solid #e6eaf2; border-radius:12px;">
          <option value="" id="selectOption">Chọn Học Viên</option>
        </select>
      </div>

      <div id="progressDetails">
        <p style="color:#64748b;" id="progressHint">Chọn học viên để xem tiến độ.</p>
      </div>
    </section>

    <section class="content-card section" id="feedbackSection" style="margin-top:16px;">
      <h2 id="feedbackTitle">Phản Hồi AI</h2>

      <div id="aiFeedback" style="background:#f1f7ff; border:1px solid #dbeafe; padding:14px; border-radius:12px;">
        <p style="color:#64748b;" id="feedbackHint">Chọn học viên (mục Tiến độ) để xem phản hồi AI.</p>

        <div id="aiFeedbackBody" style="display:none;">
          <h3 style="margin: 0 0 8px; font-weight:800;" id="fbFor">Phản hồi cho:</h3>

          <div style="margin-top: 10px;">
            <strong id="fbErrTitle">Lỗi phát âm phát hiện</strong>
            <ul id="fbErrList"></ul>
          </div>

          <div style="margin-top: 10px;">
            <strong id="fbSugTitle">Gợi ý sửa lỗi</strong>
            <p id="fbSug"></p>
          </div>

          <div style="margin-top: 10px;">
            <strong id="fbVocabTitle">Gợi ý từ vựng thay thế</strong>
            <p id="fbVocab"></p>
          </div>

          <div style="margin-top: 10px;">
            <strong id="fbPracticeTitle">Câu luyện tập</strong>
            <p id="fbPractice"></p>
          </div>
        </div>
      </div>
    </section>

    <section class="content-card section" id="tasksSection" style="margin-top:16px;">
      <h2 id="tasksTitle">Giao Bài</h2>

      <button class="btn btn-primary" id="assignNewTaskBtn" onclick="assignTask()">Giao Bài Mới</button>

      <div id="tasksList" style="margin-top: 12px;">
        <ul id="tasksUl">
          <li>Task 1: Practice pronunciation for learner 1</li>
          <li>Task 2: Review vocabulary for learner 2</li>
        </ul>
      </div>
    </section>

    <section class="content-card section" id="settingsSection" style="margin-top:16px;">
      <h2 id="settingsTitle">Cài Đặt</h2>
      <p style="color:#64748b;" id="settingsText">Các tuỳ chọn cài đặt ở đây.</p>
    </section>
  </main>

  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-column">
          <h3>AI English Speaking</h3>
          <p>Nền tảng luyện nói tiếng Anh với AI tiên tiến, giúp học viên cải thiện kỹ năng giao tiếp một cách hiệu quả.</p>
        </div>

        <div class="footer-column">
          <h3>Hỗ trợ Mentor</h3>
          <a href="#">Hướng dẫn giảng dạy</a>
          <a href="#">Tài liệu Mentor</a>
          <a href="#">Chính sách thanh toán</a>
          <a href="#">Liên hệ hỗ trợ</a>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2023 AI English Speaking Platform. Tất cả các quyền được bảo lưu.</p>
      </div>
    </div>
  </footer>

  <script>
    /* =========================================================
       CONFIG (DEMO)
    ========================================================= */
    const DEMO_MODE = true;
    const API_BASE  = "http://localhost:5000";
    const TOKEN_KEY = "token";
    const token     = localStorage.getItem(TOKEN_KEY);

    function canUseApi() {
      return !DEMO_MODE && !!token;
    }

    /* =========================================================
       I18N
    ========================================================= */
    const translations = {
      en: {
        title: "Mentor Dashboard",
        menuTop: { learners: "Learners", progress: "Progress", feedback: "Feedback", tasks: "Tasks", settings: "Settings" },
        learnersTitle: "My Learners",
        progressTitle: "Learner Progress",
        feedbackTitle: "AI Feedback",
        tasksTitle: "Tasks",
        settingsTitle: "Settings",
        settingsText: "Settings options here.",
        alertsLabel: "Alerts:",
        alertsText: "3 learners haven't practiced in 7 days. 2 need feedback.",
        searchPlaceholder: "Search by name or email",
        allStatus: "All Status",
        active: "Active",
        inactive: "Inactive",
        headers: {
          id: "ID", name: "Name", level: "Level", lastPractice: "Last Practice",
          avgScore: "Avg Score", weakSkill: "Weak Skill", status: "Status", actions: "Actions"
        },
        actions: { view: "View", feedback: "Send Feedback", assign: "Assign Task" },
        selectOption: "Select Learner",
        noData: "No learners assigned yet.",
        progressHint: "Select a learner to view progress.",
        feedbackHint: "Select a learner (Progress) to see AI feedback.",
        logout: "Logout",
        assignNewTask: "Assign New Task",
        recent: "Recent Speaking Efforts",
        date: "Date",
        score: "Score",
        fbFor: (name) => `Feedback for: ${name}`,
        fbErrTitle: "Pronunciation errors detected",
        fbSugTitle: "Suggested corrections",
        fbVocabTitle: "Vocabulary alternatives",
        fbPracticeTitle: "Practice sentences",
        profileBtn: "Mentor Profile ▼",
      },
      vi: {
        title: "Bảng Điều Khiển Mentor",
        menuTop: { learners: "Học viên", progress: "Tiến độ", feedback: "Phản hồi", tasks: "Giao bài", settings: "Cài đặt" },
        learnersTitle: "Học Viên Của Tôi",
        progressTitle: "Tiến Độ Học Viên",
        feedbackTitle: "Phản Hồi AI",
        tasksTitle: "Giao Bài",
        settingsTitle: "Cài Đặt",
        settingsText: "Các tuỳ chọn cài đặt ở đây.",
        alertsLabel: "Cảnh báo:",
        alertsText: "3 học viên chưa luyện tập 7 ngày. 2 học viên cần phản hồi.",
        searchPlaceholder: "Tìm theo tên hoặc email",
        allStatus: "Tất Cả Trạng Thái",
        active: "Hoạt Động",
        inactive: "Không Hoạt Động",
        headers: {
          id: "ID", name: "Tên", level: "Cấp Độ", lastPractice: "Lần Luyện Gần Nhất",
          avgScore: "Điểm TB", weakSkill: "Kỹ Năng Yếu", status: "Trạng Thái", actions: "Hành Động"
        },
        actions: { view: "Xem", feedback: "Gửi nhận xét", assign: "Giao bài" },
        selectOption: "Chọn Học Viên",
        noData: "Chưa có học viên nào được phân công.",
        progressHint: "Chọn học viên để xem tiến độ.",
        feedbackHint: "Chọn học viên (mục Tiến độ) để xem phản hồi AI.",
        logout: "Đăng Xuất",
        assignNewTask: "Giao Bài Mới",
        recent: "Các lần luyện nói gần đây",
        date: "Ngày",
        score: "Điểm",
        fbFor: (name) => `Phản hồi cho: ${name}`,
        fbErrTitle: "Lỗi phát âm phát hiện",
        fbSugTitle: "Gợi ý sửa lỗi",
        fbVocabTitle: "Gợi ý từ vựng thay thế",
        fbPracticeTitle: "Câu luyện tập",
        profileBtn: "Hồ Sơ Mentor ▼",
      }
    };

    let currentLang = localStorage.getItem("lang") || "vi";

    /* =========================================================
       STATE
    ========================================================= */
    let learnersCache = [];
    let progressChart = null;
    let selectedLearnerName = "";

    /* =========================================================
       HELPERS
    ========================================================= */
    function $(id){ return document.getElementById(id); }
    function escapeHtml(str){
      return String(str ?? '').replace(/[&<>"']/g, s => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'
      }[s]));
    }

    function setActiveMenu(section){
      const links = document.querySelectorAll(".nav-links a[data-section]");
      links.forEach(a => a.classList.toggle("active", a.dataset.section === section));
    }

    function showSection(section){
      setActiveMenu(section);

      const ids = ["learnersSection","progressSection","feedbackSection","tasksSection","settingsSection"];
      ids.forEach(id => $(id).classList.remove("active"));

      const map = {
        learners: "learnersSection",
        progress: "progressSection",
        feedback: "feedbackSection",
        tasks: "tasksSection",
        settings: "settingsSection"
      };
      $(map[section]).classList.add("active");

      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function toggleDropdown(){
      const dd = $("dropdown");
      dd.style.display = (dd.style.display === "block") ? "none" : "block";
    }

    window.addEventListener("click", (e) => {
      const dd = $("dropdown");
      const btn = $("profileBtn");
      if (!dd || !btn) return;
      if (!dd.contains(e.target) && !btn.contains(e.target)) dd.style.display = "none";
    });

    function logout(){
      localStorage.removeItem(TOKEN_KEY);
      alert(currentLang === "vi" ? "Đã đăng xuất (đã xoá token)." : "Logged out (token cleared).");
    }

    function switchLanguage(lang){
      currentLang = lang;
      localStorage.setItem("lang", lang);
      updateLanguage();
      renderLearners(learnersCache);

      const learnerId = $("learnerSelect").value;
      if ($("progressSection").classList.contains("active") && learnerId) {
        viewProgress(learnerId);
      }
      $("dropdown").style.display = "none";
    }

    function updateLanguage(){
      const t = translations[currentLang];

      $("title").textContent = t.title;

      $("menuLearnersTop").textContent = t.menuTop.learners;
      $("menuProgressTop").textContent = t.menuTop.progress;
      $("menuFeedbackTop").textContent = t.menuTop.feedback;
      $("menuTasksTop").textContent = t.menuTop.tasks;
      $("menuSettingsTop").textContent = t.menuTop.settings;

      $("learnersTitle").textContent = t.learnersTitle;
      $("progressTitle").textContent = t.progressTitle;
      $("feedbackTitle").textContent = t.feedbackTitle;
      $("tasksTitle").textContent = t.tasksTitle;
      $("settingsTitle").textContent = t.settingsTitle;
      $("settingsText").textContent = t.settingsText;

      $("alertsLabel").textContent = t.alertsLabel;
      $("alertsText").textContent = t.alertsText;

      $("search").placeholder = t.searchPlaceholder;
      $("allStatusOption").textContent = t.allStatus;
      $("activeOption").textContent = t.active;
      $("inactiveOption").textContent = t.inactive;

      $("idHeader").textContent = t.headers.id;
      $("nameHeader").textContent = t.headers.name;
      $("levelHeader").textContent = t.headers.level;
      $("lastPracticeHeader").textContent = t.headers.lastPractice;
      $("avgScoreHeader").textContent = t.headers.avgScore;
      $("weakSkillHeader").textContent = t.headers.weakSkill;
      $("statusHeader").textContent = t.headers.status;
      $("actionsHeader").textContent = t.headers.actions;

      $("logoutText").textContent = t.logout;
      $("assignNewTaskBtn").textContent = t.assignNewTask;
      $("assignNewTaskBtnTextTop").textContent = t.assignNewTask;

      $("profileBtn").textContent = t.profileBtn;

      $("fbErrTitle").textContent = t.fbErrTitle;
      $("fbSugTitle").textContent = t.fbSugTitle;
      $("fbVocabTitle").textContent = t.fbVocabTitle;
      $("fbPracticeTitle").textContent = t.fbPracticeTitle;

      if (selectedLearnerName) $("fbFor").textContent = t.fbFor(selectedLearnerName);
    }

    /* =========================================================
       DATA
    ========================================================= */
    function getMockLearners(){
      return [
        { id: 1, email: "learner1@example.com", name: "Nguyễn Văn A", level: "B1", lastPractice: "2026-01-05", avgScore: 78, weakSkill: "Pronunciation", status: "active" },
        { id: 2, email: "learner2@example.com", name: "Trần Thị B", level: "A2", lastPractice: "2025-12-28", avgScore: 62, weakSkill: "Vocabulary", status: "inactive" },
        { id: 3, email: "learner3@example.com", name: "Lê Minh C", level: "B2", lastPractice: "2026-01-09", avgScore: 85, weakSkill: "Grammar", status: "active" }
      ];
    }

    async function loadLearners(){
      if (!canUseApi()){
        renderLearners(getMockLearners());
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/internal/learners`, {
          headers: { Authorization: `Bearer ${token}` }
        });

        if (!res.ok){
          renderLearners(getMockLearners());
          return;
        }

        const learners = await res.json();
        renderLearners(Array.isArray(learners) ? learners : []);
      } catch (e){
        console.error("loadLearners error:", e);
        renderLearners(getMockLearners());
      }
    }

    function renderLearners(learners){
      learnersCache = learners || [];
      const t = translations[currentLang];

      const tbody = document.querySelector("#learnersTable tbody");
      tbody.innerHTML = "";

      const select = $("learnerSelect");
      select.innerHTML = `<option value="">${t.selectOption}</option>`;

      if (!learnersCache.length){
        $("noData").style.display = "block";
        return;
      }
      $("noData").style.display = "none";

      learnersCache.forEach(learner => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${escapeHtml(learner.id)}</td>
          <td>
            <div style="font-weight:700;">${escapeHtml(learner.name || "N/A")}</div>
            <div style="color:#64748b; font-size:12px;">${escapeHtml(learner.email || "")}</div>
          </td>
          <td>${escapeHtml(learner.level || "N/A")}</td>
          <td>${escapeHtml(learner.lastPractice || "N/A")}</td>
          <td>${escapeHtml(learner.avgScore ?? "N/A")}</td>
          <td>${escapeHtml(learner.weakSkill || "N/A")}</td>
          <td>${escapeHtml(learner.status || "N/A")}</td>
          <td>
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn btn-primary btn-sm" onclick="viewDetails(${learner.id})">${t.actions.view}</button>
              <button class="btn btn-outline btn-sm" onclick="sendFeedback(${learner.id})">${t.actions.feedback}</button>
              <button class="btn btn-outline btn-sm" onclick="assignTask(${learner.id})">${t.actions.assign}</button>
            </div>
          </td>
        `;
        tbody.appendChild(row);

        const opt = document.createElement("option");
        opt.value = learner.id;
        opt.textContent = `${learner.name || learner.email}`;
        select.appendChild(opt);
      });
    }

    /* =========================================================
       FILTER
    ========================================================= */
    function filterLearners(){
      const q = $("search").value.trim().toLowerCase();
      const st = $("filterStatus").value.trim().toLowerCase();

      const rows = document.querySelectorAll("#learnersTable tbody tr");
      rows.forEach(row => {
        const nameEmail = row.cells[1].innerText.toLowerCase();
        const rowStatus = row.cells[6].innerText.toLowerCase();

        const okQ = !q || nameEmail.includes(q);
        const okS = !st || rowStatus === st;

        row.style.display = (okQ && okS) ? "" : "none";
      });
    }

    /* =========================================================
       PROGRESS + CHART
    ========================================================= */
    function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }

    function mockProgress(){
      const history = [
        { date: "2025-12-28", score: 60 },
        { date: "2026-01-04", score: 68 },
        { date: "2026-01-07", score: 72 },
        { date: "2026-01-09", score: 78 },
        { date: "2026-01-11", score: 81 }
      ];
      return {
        pronunciation: rand(55, 95),
        fluency: rand(50, 92),
        vocabulary: rand(52, 94),
        grammar: rand(48, 90),
        history
      };
    }

    function viewProgress(learnerId){
      const t = translations[currentLang];
      const learner = learnersCache.find(x => String(x.id) === String(learnerId));
      selectedLearnerName = learner ? `${learner.name} (${learner.email})` : "";

      const p = mockProgress();

      const html = `
        <div style="display:grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap:10px; margin-bottom:12px;">
          <div style="background:#f8fafc; border:1px solid #e6eaf2; border-radius:12px; padding:12px; font-weight:700;">
            ${currentLang === "vi" ? "Phát Âm" : "Pronunciation"} <div style="color:#64748b; margin-top:6px;">${p.pronunciation}%</div>
          </div>
          <div style="background:#f8fafc; border:1px solid #e6eaf2; border-radius:12px; padding:12px; font-weight:700;">
            ${currentLang === "vi" ? "Trôi Chảy" : "Fluency"} <div style="color:#64748b; margin-top:6px;">${p.fluency}%</div>
          </div>
          <div style="background:#f8fafc; border:1px solid #e6eaf2; border-radius:12px; padding:12px; font-weight:700;">
            ${currentLang === "vi" ? "Từ Vựng" : "Vocabulary"} <div style="color:#64748b; margin-top:6px;">${p.vocabulary}%</div>
          </div>
          <div style="background:#f8fafc; border:1px solid #e6eaf2; border-radius:12px; padding:12px; font-weight:700;">
            ${currentLang === "vi" ? "Ngữ Pháp" : "Grammar"} <div style="color:#64748b; margin-top:6px;">${p.grammar}%</div>
          </div>
        </div>

        <div style="padding:12px; border-radius:12px; border:1px solid #e6eaf2; margin-bottom:12px; background:#fff;">
          <canvas id="progressChart" height="120"></canvas>
        </div>

        <h3 style="margin: 0 0 8px; font-weight:700;">${t.recent}</h3>
        <div class="table-container">
          <table class="data-table">
            <thead><tr><th>${t.date}</th><th>${t.score}</th></tr></thead>
            <tbody>
              ${p.history.map(h => `<tr><td>${h.date}</td><td>${h.score}</td></tr>`).join("")}
            </tbody>
          </table>
        </div>
      `;
      $("progressDetails").innerHTML = html;

      if (progressChart) progressChart.destroy();

      const ctx = document.getElementById("progressChart").getContext("2d");
      progressChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: p.history.map(h => h.date),
          datasets: [{
            label: t.score,
            data: p.history.map(h => h.score),
            borderWidth: 2,
            tension: 0.25
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true, max: 100 } }
        }
      });

      renderAIFeedback(learner);
    }

    function renderAIFeedback(learner){
      const t = translations[currentLang];

      $("feedbackHint").style.display = "none";
      $("aiFeedbackBody").style.display = "block";

      const name = learner ? `${learner.name} (${learner.email})` : "N/A";
      $("fbFor").textContent = t.fbFor(name);

      const errs = [
        `/s/ sound mispronounced in "speech"`,
        `/θ/ sound in "think" needs improvement`
      ];
      $("fbErrList").innerHTML = errs.map(e => `<li>${escapeHtml(e)}</li>`).join("");

      $("fbSug").textContent = `Practice tongue placement for /s/. Try slow → normal speed.`;
      $("fbVocab").textContent = `Use "believe" instead of "think" for better formality.`;
      $("fbPractice").textContent = `"I believe in practicing regularly."`;
    }

    /* =========================================================
       ACTIONS
    ========================================================= */
    function viewDetails(learnerId){
      showSection("progress");
      $("learnerSelect").value = String(learnerId);
      viewProgress(learnerId);
    }

    function sendFeedback(learnerId){
      showSection("feedback");
      alert(currentLang === "vi"
        ? `Đang gửi phản hồi cho học viên ${learnerId}`
        : `Sending feedback for learner ${learnerId}`);
    }

    function assignTask(learnerId){
      showSection("tasks");
      alert(currentLang === "vi"
        ? (learnerId ? `Đang giao bài cho học viên ${learnerId}` : "Đang giao bài mới")
        : (learnerId ? `Assigning task for learner ${learnerId}` : "Assigning new task"));
    }

    /* =========================================================
       INIT
    ========================================================= */
    window.onload = function(){
      updateLanguage();
      showSection("learners");
      loadLearners();

      $("learnerSelect").addEventListener("change", function(){
        const id = this.value;
        if (id){
          showSection("progress");
          viewProgress(id);
        } else {
          $("progressDetails").innerHTML = `<p style="color:#64748b;" id="progressHint">${translations[currentLang].progressHint}</p>`;
        }
      });
    };
  </script>
</body>
</html>
