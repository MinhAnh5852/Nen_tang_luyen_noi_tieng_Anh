<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Cố vấn</title>
    
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/mentor.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="page-container">
        
        <div class="page-header">
            <h1 class="page-title">Đội ngũ Cố vấn (Mentors)</h1>
            <button class="btn btn-primary">
                <i class="fa-solid fa-user-plus"></i> Thêm Cố vấn
            </button>
        </div>

        <div class="filter-bar">
            <div class="search-wrapper">
                <i class="fa-solid fa-magnifying-glass search-icon"></i>
                <input type="text" placeholder="Tìm theo tên, kỹ năng..." class="form-input input-search">
            </div>
            
            <select class="form-select">
                <option>Tất cả chuyên môn</option>
                <option>IELTS</option>
                <option>TOEIC</option>
                <option>Giao tiếp</option>
            </select>

            <select class="form-select">
                <option>Tất cả trạng thái</option>
                <option>Đang hoạt động</option>
                <option>Chờ duyệt</option>
            </select>
        </div>

        <div class="mentors-grid" id="mentors-container">
            <div style="text-align:center; width:100%; padding: 50px; color: #666;">
                <i class="fa-solid fa-spinner fa-spin"></i> Đang tải dữ liệu cố vấn...
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5005/users/all';

        document.addEventListener("DOMContentLoaded", () => {
            fetchMentors();
        });

        async function fetchMentors() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error("API Connection Failed");
                const allUsers = await response.json();

                // 1. Lọc lấy những người có role là 'mentor'
                const mentors = allUsers.filter(u => u.role === 'mentor');
                
                renderMentorCards(mentors);
            } catch (error) {
                console.error("Lỗi:", error);
                document.getElementById('mentors-container').innerHTML = `<p style="color:red; text-align:center; width:100%;">Lỗi tải dữ liệu cố vấn.</p>`;
            }
        }

        function renderMentorCards(mentors) {
            const container = document.getElementById('mentors-container');
            container.innerHTML = ''; // Xóa dòng loading

            if (mentors.length === 0) {
                container.innerHTML = '<p style="text-align:center; width:100%;">Chưa có cố vấn nào trong hệ thống.</p>';
                return;
            }

            mentors.forEach(m => {
                const shortName = m.email.split('@')[0];
                const displaySkill = m.user_level || 'English Expert';
                const isPending = m.status === 'pending';
                const statusDot = m.status === 'active' ? 'status-online' : 'status-offline';

                // Template HTML dựa trên mẫu card tĩnh của bạn
                const cardHTML = `
                    <div class="mentor-card ${isPending ? 'pending' : ''}">
                        <div class="mentor-avatar-wrapper">
                            <img src="https://ui-avatars.com/api/?name=${shortName}&background=random" class="mentor-avatar" alt="Avatar">
                            <span class="status-dot ${statusDot}"></span>
                        </div>
                        
                        <h3 class="mentor-name" style="text-transform: capitalize;">${shortName}</h3>
                        <div class="mentor-skills">
                            <span class="skill-tag">${displaySkill}</span>
                            <span class="skill-tag">Public Speaking</span>
                        </div>
                        
                        ${!isPending ? `
                            <div class="mentor-rating">
                                <div class="stars">
                                    <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star-half-stroke"></i>
                                </div>
                                <span class="rating-count">(Hồ sơ mới)</span>
                            </div>
                        ` : `
                            <div class="badge-pending">
                                <i class="fa-regular fa-clock"></i> Chờ phê duyệt
                            </div>
                        `}

                        <div class="card-actions">
                            ${isPending ? `
                                <button class="btn btn-dark">
                                    <i class="fa-solid fa-check"></i> Duyệt hồ sơ
                                </button>
                            ` : `
                                <button class="btn btn-soft-gray">Hồ sơ</button>
                                <button class="btn btn-soft-blue">Lịch dạy</button>
                            `}
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', cardHTML);
            });
        }
    </script>
</body>
</html>